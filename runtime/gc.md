# Garbadge collector
gc目前使用bdwgc


## 栈逃逸分析

除一部分runtime的方法，别的所有方法在生成代码前都会被进行逃逸分析。  
逃逸分析会遍历该方法的ast，将变量的赋值关系构造成一个图。  
然后找出逃逸点，从逃逸点开始沿着图被赋值方向遍历，所有遍历到的对象全部记录为堆分配。  
最后遍历ast生成ir的时候把所有逃逸分析的堆分配对象直接分配到堆上


## 注意事项

使用trampoline实现的closure所在的位置并不在gcroot集合中，会被bdwgc误收集。所以要手动管理它的生命周期
<!-- BDWgc只会将指向`GC_malloc`返回地址开头的指针当作对那块内存的引用，如果你的指针指向那片内存中的某个区域，这块内存是可能会被gc回收的。所以要么尽量少进行这种操作，要么进行这种操作的时候保存原指针。 -->


